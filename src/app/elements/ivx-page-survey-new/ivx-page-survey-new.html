<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../ivx-pager/ivx-pager.html">

<polymer-element name="ivx-page-survey-new" attributes="">
  <template>
    <link rel="stylesheet" href="ivx-page-survey-new.css">

    <!-- non-visual dependencies -->
    <ivx-model id="surveyModel" name="survey" storageType="localStorage"></ivx-model>

    <ivx-pager navigation="bar" showProgress="true" vertical-layout="true" on-done="{{ onSave }}" on-abort="{{ onAbort }}">
      <page optional="true">
        <div layout horizontal center-center>
          <paper-input id="title" floatingLabel="true" label="Umfragetitel"></paper-input>
        </div>
      </page>

      <page>
        <ivx-qtype-builder id="builder"></ivx-qtype-builder>
      </page>
    </ivx-pager>
  </template>

  <script>
    (function () {
      Polymer({

        onSave: function() {
          var questions = this.$.builder.getQuestions();

          var record = this.$.surveyModel.new({
            title: this.$.title.value,
            questionCount: questions.length,
            questions: questions
          });
          record.save();

          this.fire('core-signal', { name: 'show-toast', data: 'Umfrage wurde gespeichert.' });
          this.fire('core-signal', { name: 'switch-page', data: '/surveys' });
        },

        onAbort: function() {
          this.fire('core-signal', { name: 'show-toast', data: 'Erstellung der Umfrage abgebrochen.' });
          this.fire('core-signal', { name: 'switch-page', data: '/surveys' });
        }
      });
    })();
  </script>
</polymer-element>
