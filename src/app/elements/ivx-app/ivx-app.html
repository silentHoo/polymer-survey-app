<!--
`ivx-app` is the container for the survey app or the controller. It will show a `<core-drawer-panel>` containing
a drawer, a toolbar and a content area where the pages are displayed.

You can use the `ivx-app` without any configuration.

Example:

    <ivx-app></ivx-app>

@group Inovex Survey Elements
@element ivx-app
@homepage inovex.de
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="ivx-app">
  <template>
    <link rel="stylesheet" href="ivx-app.css">

    <!-- non-visual dependencies -->
    <ivx-model id="surveyModel" name="survey" storageType="localStorage"></ivx-model>
    <ivx-model id="settingModel" name="setting" storageType="localStorage"></ivx-model>

    <core-drawer-panel id="drawerPanel">
      <core-header-panel drawer>
        <ivx-drawer-content items="{{ pageItems }}" on-item-selected="{{ drawerItemSelected }}"></ivx-drawer-content>
      </core-header-panel>

      <core-header-panel main id="hPanel">

        <core-toolbar id="toolbar">
          <core-icon-button id="toggleButton" icon="menu" core-drawer-toggle></core-icon-button>
          <span flex>{{ toolbarTitle }}</span>

          <div relative>
            <ivx-context-menu id="contextMenu" items="{{ contextItems }}" on-item-selected="{{ contextItemSelected }}"></ivx-context-menu>
          </div>
        </core-toolbar>

        <div class="content" fit>
          <ivx-main-content uriToShow="{{ uriToShow }}" id="mainContent" fit></ivx-main-content>
        </div>

      </core-header-panel>
    </core-drawer-panel>

    <!-- dialog -->
    <ivx-dialog-base id="dialog" transition="core-transition-center" heading="Über diese App">
      Diese Umfrage-App ist ein Proof-of-Concept für den Einsatz von Web Components und soll zeigen, wie gut sich
      dieser neue Standard in modernen, mobilen Webanwendungen einsetzen lässt.<br>
      <br>
      Sie ist im Wintersemester 2014 im Rahmen der Master-Thesis entstanden.<br>
      <br>
      &copy; 2014-2015 Patrick Hillert
    </ivx-dialog-base>
    <!-- /dialog -->
  </template>

  <script src="../../bower_components/js-model/dist/js-model-0.11.0.min.js"></script>
  <script>
    (function () {
      'use strict';

      Polymer({
        // configuration of the single paper-buttons in the drawer panel.
        pageItems: [{
          name: 'Umfragen',
          href: '/surveys',
          closeDrawer: true,
          coreIconName: 'assignment'
        }, {
          name: 'Einstellungen',
          href: '/settings',
          closeDrawer: true,
          coreIconName: 'settings'
        }],

        // configuration of the context menu in the toolbar.
        contextItems: [{
          pageKey: 'load',
          name: 'Umfragen laden'
        }, {
          pageKey: 'about',
          name: 'Über'
        }],

        uriToShow: '',
        toolbarTitle: 'UmfrageApp',

        ready: function() {
          this._initApp();
        },

        _initApp: function() {
          // we must setup the initial settings for the first time!
          if (this.$.settingModel.all().length == 0) {
            this._initSettings();
          }
        },

        _initSettings: function() {
          var model = this.$.settingModel.new({
            pin: '1234',
            authorized: false
          });
          model.save();
        },

        // callback to load the dummy questions
        // @todo remove in production
        contextItemSelected: function(event) {
          // load questions
          if (event.detail.item.pageKey == 'load') {
            this.$.surveyModel.loadDummy();
            return;
          }

          this.$.dialog.toggle();
        },

        // callback to change the title in the toolbar.
        // Will also close the drawer, if a page needs to be shown only with the toolbar
        // and needs some more space.
        drawerItemSelected: function(event) {
          var item = event.detail.item;

          // switch to narrow mode if forced
          if (item.closeDrawer) {
            this.$.drawerPanel.narrow = true;
            this.$.drawerPanel.togglePanel();
          } else {
            this.$.drawerPanel.narrow = false;
          }

          // change title to current page title
          this.toolbarTitle = item.name;

          // route to current page
          this.uriToShow = item.href;
        }
      });

    })();
  </script>
</polymer-element>
