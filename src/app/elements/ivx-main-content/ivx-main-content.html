<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-elements/paper-elements.html">
<link rel="import" href="../../bower_components/core-elements/core-elements.html">

<polymer-element name="ivx-main-content" attributes="showPageKey">
  <template>
    <link rel="stylesheet" href="ivx-main-content.css">

    <!--<core-animated-pages selected="{{ selectedPage }}" transitions="cross-fade-all" fit>-->
    <core-pages id="pages" selected="{{ selectedPage }}" fit>
      <section>
        <ivx-page-surveylist fit></ivx-page-surveylist>
      </section>

      <section>
        <ivx-page-authorize fit></ivx-page-authorize>
      </section>
    </core-pages>
    <!--</core-animated-pages>-->

  </template>

  <script>
    (function () {
      'use strict';

      Polymer({
        pagePrefix: 'ivx-page-',
        pageMapping: {},
        selectedPage: 0,

        /* Init */
        ready: function() {
          //this.pageCount = this.shadowRoot.querySelector('core-pages').children.length;
          this.initPageMapping();
        },

        initPageMapping: function() {
          this.selectedPage = 0;
          var pageCount = 0;
          [].slice.call(this.$.pages.children).forEach(function(el, index) {
            var pageTagname = el.children[0].nodeName.toLowerCase();

            // only ivx-page-* tags are valid
            if (new RegExp(this.pagePrefix + '*').test(pageTagname)) {
              this.pageMapping[pageTagname] = pageCount++;
            }
          }, this);
        },

        /* Callbacks */
        showPageKeyChanged: function() {
          this.selectedPage = this.pageMapping[this.pagePrefix + this.showPageKey];
        }
      });

    })();
  </script>
</polymer-element>
