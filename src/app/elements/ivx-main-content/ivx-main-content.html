<!--
`ivx-main-content` is the content area wrapper for any content. For example, it can be used
 within a `<core-header-panel main>` to encapsulate the content from the outer space.

Example:

    <core-drawer-panel>
      <core-header-panel drawer>...</core-header-panel>

      <core-header-panel main>
        <core-toolbar id="toolbar">...</core-toolbar>

        <div class="content" fit>
          <ivx-main-content uriToShow="/myHomePage" fit></ivx-main-content>
        </div>

      </core-header-panel>
    </core-drawer-panel>

@group Inovex Survey Elements
@element ivx-main-content
@homepage inovex.de
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-router/app-router.html">
<link rel="import" href="../../bower_components/core-signals/core-signals.html">

<polymer-element name="ivx-main-content" attributes="uriToShow">
  <template>
    <link rel="stylesheet" href="ivx-main-content.css">

    <!-- non-visual dependencies -->
    <core-signals on-core-signal-switch-page="{{ onPageSwitch }}"></core-signals>

    <!-- history support? -->
    <app-router id="router" mode="auto" on-activate-route-end="{{ onPageHasSwitched }}">
      <app-route path="/">
        <template>
          <ivx-page-welcome fit></ivx-page-welcome>
        </template>
      </app-route>

      <app-route path="/surveys">
        <template>
          <ivx-page-surveylist on-survey-selected="{{ onSurveySelected }}" fit></ivx-page-surveylist>
        </template>
      </app-route>

      <app-route path="/authorize">
        <template>
          <ivx-page-authorize fit></ivx-page-authorize>
        </template>
      </app-route>

      <app-route path="/survey/:id">
        <template>
          <ivx-page-survey surveyId="{{ id }}" fit></ivx-page-survey>
        </template>
      </app-route>

      <app-route path="/settings">
        <template>
          <ivx-page-settings fit></ivx-page-settings>
        </template>
      </app-route>
    </app-router>

  </template>

  <script>
    (function () {
      'use strict';

      Polymer({

        publish: {
          /**
           * The uri the content page should show.
           *
           * @attribute uriToShow
           * @type String
           * @default '/'
           */
          uriToShow: '/'
        },

        // forces the router to show a detailed page with the survey
        onSurveySelected: function(event, detail, sender) {
          var surveyId = detail.survey.id;
          this.$.router.go('/survey/' + surveyId);
        },

        // as this is the content area, this method reacts on attribute changes of the uri
        uriToShowChanged: function(oldVal, newVal) {
          if (newVal != '') {
            this.$.router.go(newVal);
          }
        },

        onPageSwitch: function(event, page, sender) {
          this.$.router.go('/' + page);
        }
      });

    })();
  </script>
</polymer-element>
