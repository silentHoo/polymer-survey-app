<script>
  /**
   * These object gives a core component shared functionality to use and maintain in a central file.
   *
   * Please refer to https://www.polymer-project.org/docs/polymer/helpers.html#using-mixins for more information.
   */

  var mixinsSettings = {

    _shortVibrate: 200,
    _longVibrate: 400,

    _bootstrapSettings: function() {
      if (this.$.settingModel.all().length == 0) {
        this._seedSettingModel();
      }
      this._setupSettings();
    },

    _seedSettingModel: function() {
      var model = this.$.settingModel.new({
        pin: '1234',
        authorized: false,
        activeTheme: 'curacao',
        vibration: {
          active: false,
          long: false,
          short: false
        }
      });
      model.save();
    },

    _setupSettings: function() {
      var themeName = this.$.settingModel.first().attr('activeTheme');
      this._setTheme(themeName);
    },

    _setTheme: function(themeName) {
      document.querySelector('#themeLink').href = 'styles/theme-' + themeName + '.css';
    },

    _allThemes: function() {
      return [
        'Curacao',
        'Ruby',
        'Grinch'
      ];
    },

    _vibrateShort: function() {
      window.navigator.vibrate(this._shortVibrate);
    },

    _vibrateLong: function() {
      window.navigator.vibrate(this._longVibrate);
    },

    _getAllElements: function(subtree) {
      return subtree.querySelectorAll(
        '* /deep/ paper-fab,' +
        '* /deep/ paper-button,' +
        '* /deep/ paper-checkbox,' +
        '* /deep/ paper-dropdown,' +
        '* /deep/ paper-dropdown-menu,' +
        '* /deep/ paper-fab,' +
        '* /deep/ paper-icon-button,' +
        '* /deep/ paper-item,' +
        '* /deep/ paper-tab,' +
        '* /deep/ paper-radio-button,' +
        '* /deep/ paper-toggle-button');
    },

    _addEventHandler: function(subtree) {
      var elements = this._getAllElements(subtree);
      for (var i = 0; i < elements.length; i++) {
        elements[i].addEventListener('tap', this._onTapElement.bind(this));
      }
    },

    _removeEventHandler: function(subtree) {
      var elements = this._getAllElements(subtree);
      for (var i = 0; i < elements.length; i++) {
        elements[i].removeEventListener('tap', this._onTapElement.bind(this));
      }
    },

    _onTapElement: function() {
      var settings = this.$.settingModel.first();
      var duration = settings.attr('vibration.long') === true ? this._longVibrate : this._shortVibrate;
      window.navigator.vibrate(duration);
    }
  };
</script>
