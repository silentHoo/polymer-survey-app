<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="ivx-page-surveylist" attributes="">
  <template>
    <link rel="stylesheet" href="ivx-page-surveylist.css">

    <core-list id="list" data="{{ data }}" height="120" style="height: 100%">
      <template>

        <div surveyId="{{ model.id }}" on-tap="{{ onSurveySelected }}" class="row {{ { selected: selected } | tokenList }}" flex>
          <div class="title">{{ model.title }}</div>
          <div class="questionCount">Anzahl der Fragen: {{ model.questionCount }}</div>
          <paper-icon-button icon="more-vert" on-tap="{{ openContextDialog }}"></paper-icon-button>
        </div>

      </template>
    </core-list>

    <paper-fab class="fab" icon="add"></paper-fab>

    <!-- dialog -->
    <ivx-dialog-context id="dialog" transition="core-transition-center" layered="true" heading="{{ viewModel.dialog.title }}">
      <template repeat="{{ item in viewModel.contextList }}">
        <div class="entry">{{ item.name }}</div>
      </template>
    </ivx-dialog-context>
    <!-- /dialog -->

  </template>

  <script src="../../bower_components/js-model/dist/js-model-0.11.0.min.js"></script>
  <script>
    (function () {
      // private static

      var _surveys = [{
        title: 'Marktanalyse zum Thema Schokolade',
        questionCount: 20
      }, {
        title: 'Kundenzufriedenheit Q4 2014',
        questionCount: 11
      }, {
        title: 'Einkaufverhalten 18-25 jähriger 12/2014',
        questionCount: 42
      }, {
        title: 'Mitarbeiterzufriedenheit 2014',
        questionCount: 8
      }, {
        title: 'Designumfrage zum Thema IX-234',
        questionCount: 65
      }, {
        title: 'Fussballkonsum während der WM, Marktanalyse',
        questionCount: 23
      }, {
        title: 'Monatliche Ausgaben 30-50 jähriger Q4/2014',
        questionCount: 11
      }];

      Polymer({
        created: function() {
          this.Survey = Model('survey', function() {
            this.persistence(Model.localStorage);
          });
        },

        ready: function() {
          this.Survey.load(function(models) {

          });

          // add new questions
          if (this.Survey.all().length == 0) {
            _surveys.forEach(function(el, index) {
              var survey = new this.Survey({
                id: index,
                title: el.title,
                questionCount: el.questionCount
              });

              survey.save();
            }, this);
          }

          // init goes here
          this.data = [];
          this.selectedSection = 0;

          this.Survey.all().forEach(function(model, index) {
            this.data.push(model.attributes);
          }, this);
        },

        viewModel: {
          dialog: {
            title: 'No title'
          },

          contextList: [{
            name: 'Ergebnisse anzeigen'
          }, {
            name: 'Umfrage bearbeiten'
          }, {
            name: 'Umfrage löschen'
          }]
        },

        openContextDialog: function(event, detail, sender) {
          this.viewModel.dialog.title = this.Survey.find(sender.parentNode.getAttribute('surveyId')).attr('title');
          this.$.dialog.toggle();
        },

        onSurveySelected: function(event, detail, sender) {
          this.fire('survey-selected', {
            survey: this.Survey.find(+sender.getAttribute('surveyId')).attributes
          });
        }
      });

    })();
  </script>
</polymer-element>
